# Super Prompts for Tender and Recommendation Features

## Tender Invitations for Worker Teams

```
Нужно доработать модуль сервиса мастеров (строители, штукатуры, электрики и т.д.), добавив функционал ТЕНДЕРОВ и БРИГАД.

Идея:
- Заказчик создаёт заказ (работу).
- Несколько исполнителей и бригад могут откликаться с разными условиями.
- Заказчик сравнивает предложения (цена, сроки, рейтинг, состав бригады) и выбирает одного.
- Это похоже на тендер: заказ → несколько предложений → выбор лучшего.

==============================
1. Модель БРИГАДЫ (WorkerTeam)
==============================

Создать модель:

/models/WorkerTeam.js

Поля:
- ownerId         // пользователь, который создаёт бригаду
- name            // "Бригада отделочников", "Команда штукатуров"
- members: [      // список участников (мастеров)
    {
      workerId,
      role,       // "прораб", "штукатур", "маляр", "плиточник"
      experienceYears
    }
  ]
- categories: [ "штукатурка", "отделка", "фасад" ]
- description
- rating
- reviewsCount
- city
- geo
- priceFrom
- priceTo
- portfolio: [photoUrls]
- isVerified

API для бригад:
/api/worker-teams
- POST /create
- GET /:id
- GET /list?category=&city=
- PATCH /:id

==============================
2. Расширить Модель ЗАКАЗА под ТЕНДЕРЫ
==============================

WorkerOrder (или аналог):

Добавить поля:
- tenderType: "single" | "tender"
  // "single" — обычная заявка
  // "tender" — ожидается несколько предложений от мастеров/бригад

- maxResponses: number (опционально)
- tenderDeadline: Date (до какого времени принимать предложения)

Статусы:
- "open"           // приём откликов
- "in_evaluation"  // заказчик сравнивает
- "assigned"       // исполнитель выбран
- "done"           // завершено
- "cancelled"

==============================
3. Модель ОТКЛИКА на тендер (TenderBid)
==============================

Создать:

/models/TenderBid.js

Поля:
- orderId
- bidderType: "worker" | "team"
- bidderId    // либо workerId, либо teamId
- message     // пояснение: как сделают работу
- priceTotal  // общая цена за весь объём
- priceType: "fixed" | "per_hour" | "per_m2"
- estimatedDurationDays
- canStartAt: Date
- createdAt
- status: "pending" | "shortlisted" | "rejected" | "accepted"

----------------------------------
API:
/api/tenders

POST /bids
  body: { orderId, bidderType, bidderId, message, priceTotal, priceType, estimatedDurationDays, canStartAt }

GET /bids?orderId=...
  возвращает список откликов, отсортированных:
  - по статусу
  - по рейтингу исполнителя
  - по цене

PATCH /bids/:id/status
  - заказчик может отметить: shortlisted, rejected, accepted

==============================
4. Логика выбора победителя тендера
==============================

При выборе победителя:
- Заказчик нажимает "Выбрать это предложение".
- В TenderBid.status → "accepted".
- В Order.assignedWorkerId / assignedTeamId (в зависимости от bidderType).
- Order.status → "assigned".

Дополнительно:
- можно закрыть приём откликов автоматически, если:
  - достигнут maxResponses
  - истёк tenderDeadline

==============================
5. UI-логика (в общих чертах)
==============================

На странице заказа (OrderPage):

Если tenderType="tender":
- блок "Предложения от мастеров и бригад"
- список карточек TenderBid:
  - имя/название бригады
  - рейтинг
  - цена
  - сроки
  - начало работ
  - кнопка: "Выбрать" / "В избранное для сравнения"

====================================================
6. Логика: БРИГАДЫ могут откликаться так же, как мастера
====================================================

Если мастер создал WorkerTeam (бригаду):
- он может выбирать, откликаться от лица себя или от лица бригады.

Для отклика:
- bidderType="worker" → bidderId=workerId
- bidderType="team"   → bidderId=teamId

==============================
7. Фильтрация и сортировка откликов
==============================

При GET /bids?orderId=...

Сортировка:
1. accepted (если уже есть) 
2. shortlisted
3. pending

Внутри:
- по рейтингу (по убыванию)
- по цене (по возрастанию)
- по времени создания

==============================
8. Интеграция с чатом
==============================

Если TenderBid.status = "accepted":
- открыть чат между заказчиком и исполнителем/бригадой.
- room: "tender_<orderId>_<bidId>"

==============================
9. Права доступа
==============================

- Откликаться могут только пользователи с ролью мастер/бригада (Worker / WorkerTeam).
- Просматривать все отклики может только владелец заказа и админ.
- Остальные видят только список мастеров/бригад, а не их цены.

==============================
10. Задание

Реализовать:
- модель WorkerTeam
- модель TenderBid
- доработку WorkerOrder
- API /api/worker-teams
- API /api/tenders
- методы выбора победителя
- интеграцию с чатом
- базовую фильтрацию/сортировку откликов

Не ломать существующий сервис мастеров, добавить тендерную логику как расширение.
```

## Recommendation AI for Matching Workers and Teams

```
Нужно реализовать РЕКОМЕНДАТЕЛЬНЫЙ AI/Engine для подбора мастеров и бригад под заказ в KETMAR.

Цели:
1) Для каждого заказа → показать блок “Подходящие мастера/бригады”.
2) Для каждого мастера → рекомендовать заказы “под него”.
3) Учитывать:
   - категорию работ
   - локацию
   - бюджет
   - опыт мастера
   - рейтинг
   - историю успешных заказов
   - тип заказчика (физлицо, юрлицо)
   - формат (разовый / длительный объект)

==============================
1. Создать модуль: WorkerAiRecommender
==============================

Файл:
/services/WorkerAiRecommender.js

Методы:

1) getRecommendedWorkersForOrder(orderId)
   → возвращает список { workerId, score }

2) getRecommendedTeamsForOrder(orderId)
   → список { teamId, score }

3) getRecommendedOrdersForWorker(workerId)
   → список { orderId, score }

==============================
2. Факторы, влияющие на score
==============================

Для getRecommendedWorkersForOrder(order):

Факторы:

1) Совпадение категории:
   - если worker.categories включает order.category → +40 баллов
   - частичное совпадение (например, "ремонт" vs "отделка") → +20

2) Геолокация:
   - расстояние до заказа:
     - < 2 км → +25
     - 2–10 км → +15
     - > 10 км → +5

3) Рейтинг:
   - rating * 5 (например, 4.8 * 5 = 24)

4) История выполненных заказов по этой категории:
   - +1 балл за каждый завершённый заказ в этой категории (до лимита 20)

5) Бюджет:
   - если priceFrom/priceTo мастера пересекается с бюджетом заказа → +10
   - если мастер специализируется на премиальных работах, а бюджет низкий → -5

6) Свежесть активности:
   - если lastActive < 24h → +10
   - если не заходил > 7 дней → -10

Итог:
score = сумма всех этих факторов.

Аналогично для бригад (WorkerTeam).

==============================
3. Хранилище истории (simple)
==============================

Добавить поля:

Worker:
- completedOrdersCount
- completedOrdersByCategory: { [category]: number }

WorkerOrder:
- ratingGivenToWorker
- ratingGivenToTeam

Обновлять при завершении заказа.

==============================
4. API: Рекомендации для заказа
==============================

Создать маршрут:

GET /api/worker-reco/order/:orderId

Возвращает:

{
  orderId: "...",
  zone: "village/suburb/city_center",
  recommendedWorkers: [
    { workerId, score },
    ...
  ],
  recommendedTeams: [
    { teamId, score },
    ...
  ]
}

При вычислении:
- брать топ-50 мастеров/бригад по категории/гео → считать score → вернуть топ-10.

==============================
5. API: Рекомендации для мастера
==============================

GET /api/worker-reco/worker/:workerId

Возвращает:
{
  workerId: "...",
  recommendedOrders: [
    { orderId, score },
    ...
  ]
}

Алгоритм:
- взять открытые заказы по зоне/категории
- посчитать score учитывая:
  - категорию
  - расстояние
  - бюджет
  - сложность/тип
- вернуть топ-20

==============================
6. Дополнительные фишки (если успеем)
==============================

Можно добавить:
- boost для PRO мастеров (например, +5 к score)
- boost для новых мастеров (до первых 5 заказов) — дать шанс прорваться
- penalty для отменённых/плохих заказов (-5..-20)

==============================
7. Интеграция с UI
==============================

На стороне фронтенда:

1) Страница заказа (OrderPage):
   - блок “Подходящие мастера и бригады”
   - подтягивает /api/worker-reco/order/:orderId
   - показывает карточки WorkerCard / TeamCard отсортированные по score

2) Кабинет мастера (WorkerPage / WorkerCabinet):
   - вкладка “Рекомендованные заказы”
   - обращается к /api/worker-reco/worker/:workerId
   - показывает список OrderCard

==============================
8. Простая fallback-логика
==============================

Если AI/score-движок по каким-то причинам не может рассчитать:
- использовать упрощённый вариант:
  - фильтр по категории + расстояние + рейтинг
  - но код модуля WorkerAiRecommender всё равно должен существовать

==============================
9. Требование к производительности
==============================

- Не нужно сложных ML-моделей, достаточно правил и простого score.
- Вычисление должно работать для первых версий в памяти/через Mongo запросы.
- В будущем можно вынести в отдельный сервис.

==============================
10. Итоговое задание

Реализовать:
- services/WorkerAiRecommender.js
- маршруты /api/worker-reco/order/:orderId и /api/worker-reco/worker/:workerId
- обновление статистики исполнителей при завершении заказа
- расчёт score согласно указанным факторам
- интеграцию с UI (рекомендованные мастера/заказы)

Писать код так, чтобы его можно было развивать до ML-решения в будущем.
```
